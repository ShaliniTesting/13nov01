# pytest Configuration File
# Purpose: Defines test discovery patterns, execution settings, and coverage reporting
# for the Flask HTTP server test suite
#
# Usage:
#   pytest                              # Run all tests with default options
#   pytest --cov-fail-under=90          # Enforce 90% coverage threshold
#   pytest -v                           # Verbose output (included by default)
#   pytest --cov-report=html            # Generate HTML coverage report

[pytest]
# Test Discovery Patterns
# Defines where pytest looks for tests and how it identifies test files/functions
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test Execution Options
# -v: Verbose output showing each test name and result
# -ra: Show extra test summary info (all test outcomes)
# --cov=app: Measure code coverage for the app.py module
# --cov-report=term-missing: Show coverage report in terminal with missing lines
# --tb=short: Use shorter traceback format for cleaner error output
addopts = -v -ra --cov=app --cov-report=term-missing --tb=short

# Pytest Behavior Settings
# Display test progress with dots and summary
console_output_style = progress

# Warning Settings
# Show all warnings during test execution
filterwarnings =
    error
    ignore::DeprecationWarning:flask.*

# Markers
# Define custom test markers for categorizing tests
markers =
    unit: Unit tests for isolated components
    integration: Integration tests for complete request/response cycle
    performance: Performance validation tests
    edge_case: Edge case and boundary condition tests
    error_handling: Error scenario tests (404, 405, 500)

# Coverage Configuration
# These settings control pytest-cov behavior and coverage.py reporting

[coverage:run]
# Specify source code to measure coverage for
source = app

# Files and directories to exclude from coverage measurement
omit = 
    tests/*
    venv/*
    */venv/*
    */site-packages/*
    */__pycache__/*
    */migrations/*

# Branch coverage measurement (measures if/else branch execution)
branch = True

[coverage:report]
# Precision for coverage percentage display
precision = 2

# Show line numbers for missing coverage
show_missing = True

# Don't skip files with 100% coverage in report
skip_covered = False

# Don't show files with no executed code
skip_empty = True

# Sort coverage report by coverage percentage
sort = Cover

# Patterns to exclude from coverage requirements
# These lines won't count against coverage percentage
exclude_lines =
    # Exclude pragma comments
    pragma: no cover
    
    # Exclude abstract methods and NotImplementedError
    def __repr__
    raise AssertionError
    raise NotImplementedError
    
    # Exclude if __name__ == '__main__' blocks
    if __name__ == .__main__.:
    
    # Exclude type checking imports (only evaluated by type checkers)
    if TYPE_CHECKING:
    if typing.TYPE_CHECKING:
    
    # Exclude debug-only code
    if DEBUG:
    if settings.DEBUG
    
    # Exclude pass statements in abstract methods
    ^\s*pass\s*$
    
    # Exclude ellipsis in stub files
    ^\s*\.\.\.\s*$

[coverage:html]
# Directory for HTML coverage reports (generated with --cov-report=html)
directory = htmlcov

[coverage:xml]
# Filename for XML coverage reports (generated with --cov-report=xml)
output = coverage.xml
